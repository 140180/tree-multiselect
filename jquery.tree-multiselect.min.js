/* jQuery Tree Multiselect | Patrick Tsai, 2015 | MIT Licensed */
!function(e){function t(t){var n={sortable:!1,collapsible:!0,startCollapsed:!1};return e.extend({},n,t)}function n(t){function i(t){var n=document.createElement("div");n.className="section";var i=document.createElement("div");return i.className="title",i.innerHTML=t,e(n).append(i),e(this).append(n),n}function c(t){var n=document.createElement("div");n.className="item",n.innerHTML=t,e(this).append(n)}if(e.isArray(t))for(var a=0;a<t.length;++a)n.call(this,t[a]);else if("object"==typeof t){for(var l in t)if(t.hasOwnProperty(l)){var o=i.call(this,l);n.call(o,t[l])}}else c.call(this,t)}function i(t){var n=e("<input />",{type:"checkbox"}),i=e(t).find("div.title, div.item");n.prependTo(i)}function c(t){var n=e(t).find("div.title > input[type=checkbox]");n.change(function(){var t=e(this).closest("div.section"),n=t.find("input[type=checkbox]"),i=e(this).is(":checked");n.prop("checked",i)})}function a(t){var n="-",i="+",c=e(t).find("div.title"),a=document.createElement("div");a.className="collapse",o.startCollapsed?(e(a).text(i),c.siblings().toggle()):e(a).text(n),c.prepend(a),e("div.collapse").off().click(function(){var t=e(this).text();console.log(t),e(this).text(t==n?i:n);var c=e(this).parent();c.siblings().toggle()})}function l(t,n,i,c){function a(t){var i=document.createElement("div");i.className="item",i.id=t,i.innerHTML=t,e(n).append(i)}function l(t){var i=[];e(n).find("div.item").each(function(t,n){i.push(e(n).text())});var c=t.filter(function(e){return-1==i.indexOf(e)});c.forEach(function(e){a(e)})}function o(t){e(n).find("div.item").each(function(n,i){var c=e(i).text();-1==t.indexOf(c)&&e(i).remove()})}function r(){var t=e(i);t.empty(),e(n).find("div.item").text(function(n,i){var c=document.createElement("option");t.append(e(c).val(i).text(i).prop("selected",!0))})}function s(e){l(e),o(e),r()}var d=e(t).find("input[type=checkbox]");d.change(function(){var i=e(t).find("div.item").has("> input[type=checkbox]:checked"),a=[];if(i.text(function(e,t){a.push(t)}),s(a),c){var l=e(n);l.sortable({update:function(){r()}})}})}var o;e.fn.treeMultiselect=function(e,s){o=t(s),this.attr("multiple","").css("display","none").empty();var d=new r;d.build(this);var u=d.selections;n.call(u,e),i(u),c(u),o.collapsible&&a(u);var f=d.selected,p=o.sortable;return l(u,f,this,p),this};var r=function(){};r.prototype.build=function(t){var n=document.createElement("div");n.className="tree-multiselect",e(t).after(n);var i=document.createElement("div");i.className="selections",e(n).append(i);var c=document.createElement("div");c.className="selected",e(n).append(c),this.tree=n,this.selections=i,this.selected=c}}(jQuery);
