/* jQuery Tree Multiselect v1.4.0 | (c) Patrick Tsai | MIT Licensed */
!function(a){function b(b){var c={sortable:!1,collapsible:!0,startCollapsed:!1};return a.extend({},c,b)}function c(b){function d(b){var c=document.createElement("div");c.className="section";var d=document.createElement("div");return d.className="title",d.innerHTML=b,a(c).append(d),a(this).append(c),c}function e(b){var c=document.createElement("div");c.className="item",c.innerHTML=b,a(this).append(c)}if(a.isArray(b))for(var f=0;f<b.length;++f)c.call(this,b[f]);else if("object"==typeof b){for(var g in b)if(b.hasOwnProperty(g)){var h=d.call(this,g);c.call(h,b[g])}}else e.call(this,b)}function d(b){var c=a("<input />",{type:"checkbox"}),d=a(b).find("div.title, div.item");c.prependTo(d)}function e(b){var c=a(b).find("div.title > input[type=checkbox]");c.change(function(){var b=a(this).closest("div.section"),c=b.find("input[type=checkbox]"),d=a(this).is(":checked");c.prop("checked",d)})}function f(b){var c="-",d="+",e=a(b).find("div.title"),f=document.createElement("div");f.className="collapse",h.startCollapsed?(a(f).text(d),e.siblings().toggle()):a(f).text(c),e.prepend(f),a("div.collapse").off().click(function(){var b=a(this).text();a(this).text(b==c?d:c);var e=a(this).parent();e.siblings().toggle()})}function g(b,c,d,e){function f(b){var d=document.createElement("div");d.className="item",d.innerHTML=b,a(c).append(d)}function g(b){var d=[];a(c).find("div.item").each(function(b,c){d.push(a(c).text())});var e=b.filter(function(a){return-1==d.indexOf(a)});e.forEach(function(a){f(a)})}function h(b){a(c).find("div.item").each(function(c,d){var e=a(d).text();-1==b.indexOf(e)&&a(d).remove()})}function i(){var b=a(d);b.empty(),a(c).find("div.item").text(function(c,d){var e=document.createElement("option");b.append(a(e).val(d).text(d).prop("selected",!0))})}function j(a){g(a),h(a),i()}var k=a(b).find("input[type=checkbox]");k.change(function(){var d=a(b).find("div.item").has("> input[type=checkbox]:checked"),f=[];if(d.text(function(a,b){f.push(b)}),j(f),e){var g=a(c);g.sortable({update:function(a,b){i()}})}})}var h;a.fn.treeMultiselect=function(a,j){h=b(j),this.attr("multiple","").css("display","none").empty();var k=new i;k.build(this);var l=k.selections;c.call(l,a),d(l),e(l),h.collapsible&&f(l);var m=k.selected,n=h.sortable;return g(l,m,this,n),this};var i=function(){};i.prototype.build=function(b){var c=document.createElement("div");c.className="tree-multiselect",a(b).after(c);var d=document.createElement("div");d.className="selections",a(c).append(d);var e=document.createElement("div");e.className="selected",a(c).append(e),this.tree=c,this.selections=d,this.selected=e}}(jQuery);